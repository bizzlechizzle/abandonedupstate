---
// GLightbox component for image galleries
---

<script>
  import GLightbox from 'glightbox';
  import 'glightbox/dist/css/glightbox.min.css';
  
  function syncLightboxCaptions(root = document) {
    const links = Array.from(
      root.querySelectorAll<HTMLAnchorElement>('a.glightbox')
    );

    links.forEach(link => {
      const img = link.querySelector('img');
      const caption = link.dataset.caption?.trim();
      const seoCaption = link.dataset.seoCaption?.trim();
      const visibleCaption = link.querySelector('[data-gallery-caption]');

      if (caption) {
        link.dataset.title = caption;
        if (visibleCaption && visibleCaption.textContent !== caption) {
          visibleCaption.textContent = caption;
        }
      } else {
        link.removeAttribute('data-title');
      }

      link.removeAttribute('data-description');
      delete link.dataset.description;

      if (img) {
        if (seoCaption) {
          img.alt = seoCaption;
        } else if (caption && !img.alt) {
          img.alt = caption;
        }
      }
    });
  }

  function initGLightbox() {
    syncLightboxCaptions();
    // Initialize GLightbox
    const lightbox = GLightbox({
      touchNavigation: true,
      loop: true,
      autoplayVideos: true,
      plyr: {
        css: 'https://cdn.plyr.io/3.6.8/plyr.css',
        js: 'https://cdn.plyr.io/3.6.8/plyr.js',
        config: {
          ratio: '16:9',
          youtube: {
            noCookie: true,
            rel: 0,
            showinfo: 0,
            iv_load_policy: 3
          },
          vimeo: {
            byline: false,
            portrait: false,
            title: false,
            transparent: false
          }
        }
      }
    });

    // Re-initialize when navigating (for Astro transitions)
    document.addEventListener('astro:page-load', () => {
      syncLightboxCaptions();
      lightbox.reload();
    });
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', initGLightbox);
  
  // Re-initialize after page transitions
  document.addEventListener('astro:page-load', initGLightbox);
</script>

<style>
  /* Custom GLightbox styles for Abandoned Upstate theme */
  .glightbox-clean .gslide-description {
    background: rgba(0, 0, 0, 0.8);
    color: #fff;
    padding: 15px;
    font-size: 14px;
    line-height: 1.4;
    border-radius: 4px;
  }
  
  .glightbox-clean .gprev,
  .glightbox-clean .gnext {
    background: rgba(0, 0, 0, 0.6);
    border-radius: 50%;
  }
  
  .glightbox-clean .gprev:hover,
  .glightbox-clean .gnext:hover {
    background: rgba(0, 0, 0, 0.8);
  }
</style>
